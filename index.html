
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>OvO Flash TAS Platformer</title>

  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: #111;
      overflow: hidden;
      touch-action: none;
    }

    #game {
      display: block;
      margin: 0 auto;
      background: #222;
      image-rendering: pixelated;
    }

    .controls {
      position: fixed;
      bottom: 20px;
      z-index: 10;
      user-select: none;
    }

    .controls-left {
      left: 20px;
    }

    .controls-right {
      right: 20px;
    }

    .btn {
      width: 60px;
      height: 60px;
      margin: 5px;
      border-radius: 50%;
      border: 2px solid #fff;
      color: #fff;
      background: rgba(255, 255, 255, 0.08);
      font-size: 28px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }

    .btn:active {
      background: rgba(255, 255, 255, 0.25);
    }
  </style>
</head>

<body>
  <canvas id="game" width="960" height="540"></canvas>

  <!-- On-screen controls -->
  <div class="controls controls-left">
    <div class="btn" id="btn-left">&lt;</div>
    <div class="btn" id="btn-right">&gt;</div>
  </div>

  <div class="controls controls-right">
    <div class="btn" id="btn-up">▲</div>
    <div class="btn" id="btn-down">▼</div>
  </div>

  <script>
    /* ============================================================
       OVO‑INSPIRED PLATFORMER — FLASH TAS EDITION
       Two Levels • Lives • Death • Respawn • Camera • Hazards
       With on-screen controls (left/right/up/down)
       ============================================================ */

    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");

    // ---------------- INPUT ----------------
    const keys = {};
    window.addEventListener("keydown", e => keys[e.code] = true);
    window.addEventListener("keyup",   e => keys[e.code] = false);

    // Touch / on-screen buttons state
    let touchLeft = false;
    let touchRight = false;
    let touchUp = false;
    let touchDown = false;

    function bindButton(id, setter) {
      const el = document.getElementById(id);
      const start = e => { e.preventDefault(); setter(true); };
      const end   = e => { e.preventDefault(); setter(false); };

      el.addEventListener("mousedown", start);
      el.addEventListener("touchstart", start, { passive: false });

      window.addEventListener("mouseup", end);
      window.addEventListener("touchend", end);
      window.addEventListener("touchcancel", end);
      window.addEventListener("mouseleave", end);
    }

    bindButton("btn-left",  v => touchLeft = v);
    bindButton("btn-right", v => touchRight = v);
    bindButton("btn-up",    v => touchUp = v);
    bindButton("btn-down",  v => touchDown = v);

    // ---------------- CONSTANTS ----------------
    const GRAVITY = 0.7;
    const FRICTION = 0.82;
    const MOVE_SPEED = 1.0;
    const MAX_X_SPEED = 10;
    const JUMP_FORCE = -14;
    const WALL_JUMP_FORCE_X = 11;
    const WALL_JUMP_FORCE_Y = -13;
    const FAST_FALL = 1.4;

    let cameraX = 0;
    const CAMERA_MARGIN_X = 260;

    // ---------------- LEVEL DATA ----------------

    const LEVEL1 = {
      spawn: { x: 80, y: 360 },
      platforms: [
        { x: 0, y: 460, w: 300, h: 80 },
        { x: 380, y: 420, w: 80, h: 20 },
        { x: 520, y: 380, w: 80, h: 20 },
        { x: 660, y: 340, w: 80, h: 20 },
        { x: 820, y: 260, w: 40, h: 220 },
        { x: 980, y: 260, w: 40, h: 220 },
        { x: 1120, y: 420, w: 60, h: 20 },
        { x: 1240, y: 380, w: 60, h: 20 },
        { x: 1360, y: 340, w: 60, h: 20 },
        { x: 1480, y: 300, w: 60, h: 20 },
        { x: 1620, y: 200, w: 40, h: 260 },
        { x: 1760, y: 160, w: 40, h: 300 },
        { x: 1900, y: 320, w: 80, h: 20 },
        { x: 2060, y: 420, w: 60, h: 20 },
        { x: 2180, y: 380, w: 60, h: 20 },
        { x: 2300, y: 340, w: 60, h: 20 },
        { x: 2420, y: 300, w: 60, h: 20 },
        { x: 2580, y: 260, w: 120, h: 20 }
      ],
      hazards: [
        { x: 300, y: 500, w: 400, h: 40 },
        { x: 900, y: 500, w: 400, h: 40 },
        { x: 1500, y: 500, w: 600, h: 40 },
        { x: 1100, y: 440, w: 120, h: 40 },
        { x: 1220, y: 400, w: 120, h: 40 },
        { x: 1340, y: 360, w: 120, h: 40 },
        { x: 1460, y: 320, w: 120, h: 40 },
        { x: 2000, y: 500, w: 800, h: 40 }
      ],
      goal: { x: 2620, y: 200, w: 40, h: 60 }
    };

    const LEVEL2 = {
      spawn: { x: 80, y: 360 },
      platforms: [
        { x: 0, y: 460, w: 300, h: 80 },
        { x: 400, y: 420, w: 40, h: 20 },
        { x: 500, y: 380, w: 40, h: 20 },
        { x: 600, y: 340, w: 40, h: 20 },
        { x: 700, y: 300, w: 40, h: 20 },
        { x: 800, y: 260, w: 40, h: 20 },
        { x: 900, y: 220, w: 40, h: 20 },
        { x: 1000, y: 180, w: 40, h: 20 },
        { x: 1100, y: 140, w: 40, h: 20 },
        { x: 1200, y: 100, w: 40, h: 20 },
        { x: 1400, y: 200, w: 200, h: 20 }
      ],
      hazards: [
        { x: 300, y: 500, w: 1200, h: 40 },
        { x: 1300, y: 500, w: 600, h: 40 }
      ],
      goal: { x: 1500, y: 140, w: 40, h: 60 }
    };

    let currentLevel = 1;
    let LEVEL = LEVEL1;

    // ---------------- PLAYER ----------------
    const player = {
      x: 0, y: 0,
      w: 26, h: 44,
      vx: 0, vy: 0,
      onGround: false,
      canDoubleJump: true,
      touchingWallLeft: false,
      touchingWallRight: false,
      wallSliding: false,
      facing: 1,
      lives: 5,
      win: false,
      dead: false
    };

    function loadLevel(level) {
      LEVEL = level === 1 ? LEVEL1 : LEVEL2;
      player.x = LEVEL.spawn.x;
      player.y = LEVEL.spawn.y;
      player.vx = 0;
      player.vy = 0;
      cameraX = 0;
      player.win = false;
      player.dead = false;
    }

    // ---------------- COLLISION HELPERS ----------------
    function rectIntersect(a, b) {
      return (
        a.x < b.x + b.w &&
        a.x + a.w > b.x &&
        a.y < b.y + b.h &&
        a.y + a.h > b.y
      );
    }

    // ---------------- PHYSICS ----------------
    let jumpPressedLastFrame = false;

    function handleInput() {
      const left  = keys["ArrowLeft"] || keys["KeyA"] || touchLeft;
      const right = keys["ArrowRight"] || keys["KeyD"] || touchRight;
      const jump  = keys["Space"] || keys["KeyW"] || keys["ArrowUp"] || touchUp;
      const down  = keys["ArrowDown"] || keys["KeyS"] || touchDown;

      if (left) {
        player.vx -= MOVE_SPEED;
        player.facing = -1;
      } else if (right) {
        player.vx += MOVE_SPEED;
        player.facing = 1;
      } else {
        player.vx *= FRICTION;
      }

      player.vx = Math.max(Math.min(player.vx, MAX_X_SPEED), -MAX_X_SPEED);

      if (jump && !jumpPressedLastFrame) {
        if (player.onGround) {
          player.vy = JUMP_FORCE;
        } else if (player.wallSliding) {
          const dir = player.touchingWallLeft ? 1 : -1;
          player.vx = dir * WALL_JUMP_FORCE_X;
          player.vy = WALL_JUMP_FORCE_Y;
        } else if (player.canDoubleJump) {
          player.vy = JUMP_FORCE;
          player.canDoubleJump = false;
        }
      }

      if (down && !player.onGround && !player.wallSliding) {
        player.vy += FAST_FALL;
      }

      jumpPressedLastFrame = jump;
    }

    function resolveCollisions() {
      player.onGround = false;
      player.touchingWallLeft = false;
      player.touchingWallRight = false;
      player.wallSliding = false;

      const p = { ...player };

      // Horizontal
      p.x += player.vx;
      for (const tile of LEVEL.platforms) {
        if (rectIntersect(p, tile)) {
          if (player.vx > 0) {
            p.x = tile.x - player.w;
            player.touchingWallRight = true;
          } else if (player.vx < 0) {
            p.x = tile.x + tile.w;
            player.touchingWallLeft = true;
          }
          player.vx = 0;
        }
      }

      // Vertical
      p.y += player.vy;
      for (const tile of LEVEL.platforms) {
        if (rectIntersect(p, tile)) {
          if (player.vy > 0) {
            p.y = tile.y - player.h;
            player.onGround = true;
            player.canDoubleJump = true;
          } else if (player.vy < 0) {
            p.y = tile.y + tile.h;
          }
          player.vy = 0;
        }
      }

      if (!player.onGround && (player.touchingWallLeft || player.touchingWallRight) && player.vy > 0) {
        player.wallSliding = true;
        player.vy = Math.min(player.vy, 3.2);
        player.canDoubleJump = true;
      }

      player.x = p.x;
      player.y = p.y;
    }

    function handleHazards() {
      for (const spike of LEVEL.hazards) {
        if (rectIntersect(player, spike)) {
          killPlayer();
          return;
        }
      }

      if (player.y > 800) killPlayer();

      if (rectIntersect(player, LEVEL.goal)) {
        if (currentLevel === 1) {
          currentLevel = 2;
          loadLevel(2);
        } else {
          player.win = true;
        }
      }
    }

    function killPlayer() {
      player.lives--;
      if (player.lives <= 0) {
        player.lives = 0;
        player.dead = true;
        return;
      }
      loadLevel(currentLevel);
    }

    function updateCamera() {
      const targetX = player.x + player.w / 2;
      const leftBound = cameraX + CAMERA_MARGIN_X;
      const rightBound = cameraX + canvas.width - CAMERA_MARGIN_X;

      if (targetX < leftBound) cameraX = targetX - CAMERA_MARGIN_X;
      else if (targetX > rightBound) cameraX = targetX - (canvas.width - CAMERA_MARGIN_X);

      if (cameraX < 0) cameraX = 0;
    }

    // ---------------- DRAWING ----------------
    function drawLevel() {
      ctx.fillStyle = "#111";
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      ctx.fillStyle = "#444";
      for (const tile of LEVEL.platforms) {
        ctx.fillRect(tile.x - cameraX, tile.y, tile.w, tile.h);
      }

      ctx.fillStyle = "#c33";
      for (const spike of LEVEL.hazards) {
        const step = 20;
        for (let x = spike.x; x < spike.x + spike.w; x += step) {
          ctx.beginPath();
          ctx.moveTo(x - cameraX, spike.y + spike.h);
          ctx.lineTo(x - cameraX + step / 2, spike.y);
          ctx.lineTo(x - cameraX + step, spike.y + spike.h);
          ctx.fill();
        }
      }

      const g = LEVEL.goal;
      ctx.fillStyle = "#888";
      ctx.fillRect(g.x - cameraX + g.w / 2 - 2, g.y, 4, g.h);
      ctx.fillStyle = "#0f0";
      ctx.beginPath();
      ctx.moveTo(g.x - cameraX + g.w / 2 + 2, g.y);
      ctx.lineTo(g.x - cameraX + g.w / 2 + 26, g.y + 10);
      ctx.lineTo(g.x - cameraX + g.w / 2 + 2, g.y + 20);
      ctx.fill();
    }

    function drawPlayer() {
      ctx.save();
      ctx.translate(player.x - cameraX + player.w / 2, player.y + player.h / 2);
      ctx.scale(player.facing, 1);

      ctx.fillStyle = "#d01010";
      ctx.fillRect(-player.w / 2, -player.h / 2, player.w, player.h);

      ctx.fillStyle = "#f5d000";
      ctx.fillRect(-player.w / 2, player.h / 2 - 10, player.w, 10);

      ctx.fillRect(-player.w / 2, -4, player.w, 4);

      ctx.fillStyle = "#e02020";
      ctx.fillRect(-player.w / 2 + 4, -player.h / 2 - 10, player.w - 8, 14);

      ctx.fillStyle = "#fff";
      ctx.fillRect(-4, -player.h / 2 - 6, 3, 3);
      ctx.fillRect(1, -player.h / 2 - 6, 3, 3);

      ctx.strokeStyle = "#f5d000";
      ctx.lineWidth = 2;
      ctx.beginPath();
      ctx.moveTo(-player.w / 2 + 2, -player.h / 2 - 4);
      ctx.lineTo(-player.w / 2 - 4, -player.h / 2);
      ctx.lineTo(-player.w / 2 + 2, -player.h / 2 + 4);
      ctx.stroke();

      ctx.beginPath();
      ctx.moveTo(player.w / 2 - 2, -player.h / 2 - 4);
      ctx.lineTo(player.w / 2 + 4, -player.h / 2);
      ctx.lineTo(player.w / 2 - 2, -player.h / 2 + 4);
      ctx.stroke();

      ctx.fillStyle = "#f5d000";
      ctx.beginPath();
      ctx.arc(0, -player.h / 2 + 20, 6, 0, Math.PI * 2);
      ctx.fill();

      ctx.fillStyle = "#d01010";
      ctx.beginPath();
      ctx.moveTo(-2, -player.h / 2 + 16);
      ctx.lineTo(2, -player.h / 2 + 20);
      ctx.lineTo(-1, -player.h / 2 + 24);
      ctx.fill();

      ctx.restore();
    }

    function drawHUD() {
      ctx.fillStyle = "#fff";
      ctx.font = "16px monospace";
      ctx.fillText(`Lives: ${player.lives}`, 16, 24);
      ctx.fillText(`Level: ${currentLevel}`, 16, 48);

      if (player.dead) {
        ctx.fillStyle = "#fff";
        ctx.font = "48px monospace";
        ctx.fillText("GAME OVER", canvas.width / 2 - 150, canvas.height / 2);
        ctx.font = "24px monospace";
        ctx.fillText("Press R to restart", canvas.width / 2 - 120, canvas.height / 2 + 40);

        if (keys["KeyR"]) {
          player.lives = 5;
          currentLevel = 1;
          loadLevel(1);
        }
      }

      if (player.win) {
        ctx.fillStyle = "#0f0";
        ctx.font = "48px monospace";
        ctx.fillText("YOU WIN!", canvas.width / 2 - 120, canvas.height / 2);
      }
    }

    // ---------------- MAIN LOOP ----------------
    function update() {
      if (player.dead || player.win) return;

      handleInput();
      player.vy += GRAVITY;
      resolveCollisions();
      handleHazards();
      updateCamera();
    }

    function loop() {
      update();
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      drawLevel();
      drawPlayer();
      drawHUD();
      requestAnimationFrame(loop);
    }

    loadLevel(1);
    loop();
  </script>
</body>
</html>
